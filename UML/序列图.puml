@startuml
title 点单程序网 — 用户下单流程序列图

skinparam {
  shadowing false
  roundcorner 6
  defaultFontName "PingFang SC"
  defaultFontSize 11
  
  ' 简约配色
  ActorBorderColor #34495E
  ParticipantBorderColor #5D6D7E
  DatabaseBorderColor #85929E
  ArrowColor #566573
  LifeLineBorderColor #BDC3C7
  
  ' 分组样式
  SequenceGroupBodyBackgroundColor #FDFEFE
  SequenceGroupBorderColor #AEB6BF
}

actor 顾客 as C
participant "Web前端" as UI
participant "API网关" as API
participant "订单服务" as OS
participant "库存服务" as IS
database "数据库" as DB

== 用户认证 ==
C -> UI : 输入用户名 + ID
UI -> API : POST /login
API -> DB : 验证/创建用户
DB --> API : 用户信息
API --> UI : 登录成功
UI --> C : 跳转主页

== 菜品浏览 ==
C -> UI : 选择分类\n(特色/肉/素/酒水/主食)
UI -> API : GET /dishes?category=...
API -> DB : 查询菜品与库存
DB --> API : 菜品列表
API --> UI : 返回菜品(含库存状态)
UI --> C : 展示菜品卡片

== 配置订单 ==
C -> UI : 选择菜品\n配置口味、分量、备注
UI -> API : GET /stock?dishId={id}
API -> IS : 检查库存
IS -> DB : 读取实时库存
DB --> IS : stock
IS --> API : 库存状态
API --> UI : 可下单
UI --> C : 显示"可下单"

== 提交订单 ==
C -> UI : 点击"提交订单"
UI -> API : POST /orders\n{items, options, remark}
activate API
API -> OS : createOrder(...)
activate OS

OS -> IS : 校验并扣减库存
activate IS
IS -> DB : UPDATE stock [事务开始]
DB --> IS : 扣减成功
IS --> OS : 库存已扣减
deactivate IS

OS -> DB : INSERT orders & items [事务]
DB --> OS : orderId
deactivate OS

OS --> API : 订单创建成功
deactivate API
API --> UI : {orderId, totalPrice}
UI --> C : 展示确认页\n(线下付款)

note right of UI
  <b>前端展示要求</b>
  • 按分类分组展示菜品
  • 标注库存与售罄状态
  • 价格清晰、操作直观
end note

note over OS, IS
  <b>事务保证</b>
  库存扣减与订单创建
  在同一事务中完成
end note

@enduml
